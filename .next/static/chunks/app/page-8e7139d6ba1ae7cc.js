(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4830:function(e,t,r){Promise.resolve().then(r.bind(r,2388))},2388:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return C}});var a=r(7437),s=r(2265),o=r(7776),n=r(4264),l=r(6777),i=r(9938),c=r(843);let d={mixamorigHips:"hips",mixamorigSpine:"spine",mixamorigSpine1:"chest",mixamorigSpine2:"upperChest",mixamorigNeck:"neck",mixamorigHead:"head",mixamorigLeftShoulder:"leftShoulder",mixamorigLeftArm:"leftUpperArm",mixamorigLeftForeArm:"leftLowerArm",mixamorigLeftHand:"leftHand",mixamorigRightShoulder:"rightShoulder",mixamorigRightArm:"rightUpperArm",mixamorigRightForeArm:"rightLowerArm",mixamorigRightHand:"rightHand",mixamorigLeftUpLeg:"leftUpperLeg",mixamorigLeftLeg:"leftLowerLeg",mixamorigLeftFoot:"leftFoot",mixamorigRightUpLeg:"rightUpperLeg",mixamorigRightLeg:"rightLowerLeg",mixamorigRightFoot:"rightFoot"},u=new o.Quaternion().setFromEuler(new o.Euler(0,0,1)),m=new o.Quaternion().setFromEuler(new o.Euler(0,0,-1)),x={leftUpperArm:u,rightUpperArm:m,leftLowerArm:u,rightLowerArm:m},p={leftUpperArm:[0,0,1.3],rightUpperArm:[0,0,-1.3],leftLowerArm:[0,0,.1],rightLowerArm:[0,0,-.1]};var f=r(8674);function h(e){let{vrmId:t,emotion:r,onReady:l,unlocked:u=!1,isApproaching:m=!1}=e,h=(0,s.useMemo)(()=>"/vrm/".concat(t,".vrm"),[t]),b=(0,n.H)(i.E,h,e=>{e.crossOrigin="anonymous",e.register(e=>new c.XX(e))}),[g,y]=(0,s.useState)(null),v=(0,s.useRef)(),[j,w]=(0,s.useState)(null),N=(0,s.useRef)(null);return(0,s.useEffect)(()=>{var e;if(!(null==b?void 0:null===(e=b.userData)||void 0===e?void 0:e.vrm))return;let t=b.userData.vrm;c.ck.rotateVRM0(t),t.scene.traverse(e=>{if(e.isMesh&&e.material){e.frustumCulled=!1,e.userData.originalMat||(e.userData.originalMat=Array.isArray(e.material)?e.material:e.material.clone());let t=e.name.toLowerCase(),r=e.material.name?e.material.name.toLowerCase():"";e.userData.isEye=t.includes("eye")||r.includes("eye")||t.includes("face")||r.includes("iris")}}),t&&t.humanoid&&Object.entries(p).forEach(e=>{let[r,a]=e,s=t.humanoid.getNormalizedBoneNode(r);s&&s.rotation.set(...a)}),y(t),l&&l(t)},[b,l]),!function(e,t,r){let[a,l]=(0,s.useState)(null),i=(0,s.useRef)({}),c=(0,s.useRef)({}),u=(0,n.H)(f.y,t,e=>{e.crossOrigin="anonymous"});(0,s.useEffect)(()=>{e&&Object.values(d).forEach(t=>{let r=e.humanoid.getNormalizedBoneNode(t);r&&!i.current[t]&&(i.current[t]=r.quaternion.clone())})},[e]),(0,s.useEffect)(()=>{if(!u)return;let e=new o.AnimationMixer(u);return e.clipAction(u.animations[0]).play(),l(e),c.current={},()=>e.stopAllAction()},[u]),(0,n.F)((t,s)=>{!r&&(a&&a.update(s),e&&u&&u.traverse(t=>{if(t.isBone&&d[t.name]){let r=d[t.name],a=e.humanoid.getNormalizedBoneNode(r),s=i.current[r];if(a&&s){c.current[t.name]||(c.current[t.name]=t.quaternion.clone());let e=c.current[t.name],o=t.quaternion,n=e.clone().invert().multiply(o),l=x[r];if(l){let e=l.clone().invert(),t=l.clone().multiply(n).multiply(e);n.copy(t)}a.quaternion.copy(s).multiply(n)}}}))})}(g,"/vrm/idle.fbx",m),(0,s.useEffect)(()=>{if(!g)return;let e=new o.MeshBasicMaterial({color:65535,wireframe:!0,transparent:!0,opacity:.3,skinning:!0,side:o.DoubleSide});g.scene.traverse(t=>{t.isMesh&&t.userData.originalMat&&(t.userData.isEye?(t.material=t.userData.originalMat,t.material.emissive&&t.material.emissive.setHex(2236962)):(t.material=u?t.userData.originalMat:e,t.material.needsUpdate=!0))})},[u,g]),(0,n.F)((e,t)=>{let a=e.clock.elapsedTime;if(v.current&&(m?(v.current.position.z=o.MathUtils.lerp(v.current.position.z,2.5,2*t),v.current.position.y=o.MathUtils.lerp(v.current.position.y,0,3*t)):(v.current.position.y=.05*Math.sin(1.2*a)+.05,v.current.position.z=o.MathUtils.lerp(v.current.position.z,0,2*t))),g){let e="happy"===r||m?1:0,s="neutral"!==r||m?0:.5;if("head"===j?(e=1,s=0):"body"===j&&(s=0,e=.2),g.expressionManager&&(g.expressionManager.setValue("blink",Math.min(1,Math.max(0,5*Math.sin(2.5*a)-4))),g.expressionManager.setValue("happy",e),g.expressionManager.setValue("neutral",s),g.expressionManager.update()),!m){let e=g.humanoid.getNormalizedBoneNode("hips");e&&(e.rotation.z=.02*Math.sin(.8*a),e.rotation.x=.01*Math.sin(1.2*a))}if("head"===j){let e=g.humanoid.getNormalizedBoneNode("head");e&&(e.rotation.z+=.1*Math.sin(15*a))}g.update(t)}}),g?(0,a.jsxs)("group",{ref:v,children:[(0,a.jsx)("primitive",{object:g.scene}),(0,a.jsxs)("mesh",{position:[0,.8,0],onClick:e=>{if(!u)return;e.stopPropagation();let t=e.point.y;N.current&&clearTimeout(N.current),t>1.3?w("head"):w("body"),N.current=setTimeout(()=>w(null),1500)},visible:!1,onPointerOver:()=>document.body.style.cursor="pointer",onPointerOut:()=>document.body.style.cursor="auto",children:[(0,a.jsx)("cylinderGeometry",{args:[.4,.4,1.7,8]}),(0,a.jsx)("meshBasicMaterial",{color:"red",wireframe:!0,opacity:.5,transparent:!0})]})]}):null}class b extends s.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e){console.error("3D Stage Error:",e)}render(){return this.state.hasError?(0,a.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-red-500 text-sm bg-black/90 p-4 rounded border border-red-500",children:"⚠️ 3D Error"}):this.props.children}constructor(e){super(e),this.state={hasError:!1}}}function g(){return(0,a.jsxs)("mesh",{visible:!1,children:[(0,a.jsx)("boxGeometry",{}),(0,a.jsx)("meshBasicMaterial",{color:"black"})]})}function y(){let e=(0,s.useRef)(),t=(0,s.useRef)();return(0,n.F)(r=>{let a=r.clock.elapsedTime;e.current&&(e.current.rotation.z=.05*a),t.current&&(t.current.rotation.z=-(.1*a))}),(0,a.jsxs)("group",{position:[0,-.2,0],children:[(0,a.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.05,0],children:[(0,a.jsx)("circleGeometry",{args:[.8,64]}),(0,a.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:2,transparent:!0,opacity:.8})]}),(0,a.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],children:[(0,a.jsx)("ringGeometry",{args:[.8,1.2,64]}),(0,a.jsx)("meshStandardMaterial",{color:"#1a1a2e",metalness:.8,roughness:.2})]}),(0,a.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.01,0],children:[(0,a.jsx)("ringGeometry",{args:[1.18,1.2,64]}),(0,a.jsx)("meshBasicMaterial",{color:"#00aaff"})]}),(0,a.jsxs)("group",{rotation:[-Math.PI/2,0,0],position:[0,.1,0],children:[(0,a.jsx)("group",{ref:e,children:(0,a.jsxs)("mesh",{children:[(0,a.jsx)("ringGeometry",{args:[1.3,1.35,64,8]}),(0,a.jsx)("meshBasicMaterial",{color:"#00ffff",transparent:!0,opacity:.3,side:o.DoubleSide,wireframe:!0})]})}),(0,a.jsx)("group",{ref:t,children:(0,a.jsxs)("mesh",{children:[(0,a.jsx)("ringGeometry",{args:[1,1.02,64,16]}),(0,a.jsx)("meshBasicMaterial",{color:"#0088ff",transparent:!0,opacity:.5,side:o.DoubleSide})]})})]}),[0,90,180,270].map((e,t)=>(0,a.jsxs)("group",{rotation:[0,o.MathUtils.degToRad(e),0],children:[(0,a.jsxs)("mesh",{position:[1.1,-.5,0],rotation:[0,0,.2],children:[(0,a.jsx)("boxGeometry",{args:[.1,1,.1]}),(0,a.jsx)("meshStandardMaterial",{color:"#222233",metalness:.9})]}),(0,a.jsxs)("mesh",{position:[1.1,-.5,0],rotation:[0,0,.2],children:[(0,a.jsx)("boxGeometry",{args:[.02,1,.02]}),(0,a.jsx)("meshBasicMaterial",{color:"#00ffff",transparent:!0,opacity:.7})]})]},t)),(0,a.jsx)("spotLight",{position:[0,-2,0],"target-position":[0,2,0],intensity:8,distance:8,angle:.6,penumbra:.5,color:"#00ffff"}),(0,a.jsx)("pointLight",{position:[0,.5,0],intensity:5,distance:4,color:"#0088ff"})]})}function v(e){let{active:t}=e,r=(0,s.useRef)(),[l]=(0,s.useState)(()=>{let e=new Float32Array(600);for(let t=0;t<200;t++){let r=Math.random()*Math.PI*2,a=.5+1*Math.random();e[3*t]=Math.cos(r)*a,e[3*t+1]=3*Math.random(),e[3*t+2]=Math.sin(r)*a}return e});return(0,n.F)((e,a)=>{if(!r.current)return;let s=r.current.geometry.attributes.position,o=t?4:1;for(let e=0;e<200;e++){let t=s.array[3*e+1];(t+=a*(.3+.4*Math.random())*o)>4&&(t=0),s.array[3*e+1]=t}s.needsUpdate=!0}),(0,a.jsxs)("points",{ref:r,position:[0,-.5,0],children:[(0,a.jsx)("bufferGeometry",{children:(0,a.jsx)("bufferAttribute",{attach:"attributes-position",count:200,array:l,itemSize:3})}),(0,a.jsx)("pointsMaterial",{size:.04,color:t?"#ffffff":"#00aaff",transparent:!0,opacity:.8,sizeAttenuation:!0,blending:o.AdditiveBlending,depthWrite:!1})]})}function j(e){let{targetRef:t,triggerKey:r}=e,{camera:a}=(0,n.D)(),l=(0,s.useRef)(!1);return s.useEffect(()=>{l.current=!1},[r]),(0,n.F)(()=>{!l.current&&t.current&&0!==t.current.children.length&&(a.position.lerp(new o.Vector3(0,1.6,4.2),.1),a.lookAt(0,1,0),.1>Math.abs(a.position.z-4.2)&&(l.current=!0))}),null}function w(e){let{vrmId:t="avatar_01",emotion:r="idle",unlocked:n=!1,onModelReady:i,isApproaching:c=!1}=e,d=(0,s.useRef)(),[u,m]=(0,s.useState)(0);return(0,a.jsx)("div",{className:"w-full h-full relative bg-gradient-to-b from-[#02020a] to-[#050515]",children:(0,a.jsx)(b,{vrmId:t,children:(0,a.jsxs)(l.Xz,{shadows:!0,dpr:[1,1.5],camera:{position:[0,1.8,5],fov:35},gl:{alpha:!0,antialias:!0,preserveDrawingBuffer:!0,toneMapping:o.ACESFilmicToneMapping,toneMappingExposure:1.1},children:[(0,a.jsx)("fog",{attach:"fog",args:["#050515",5,15]}),(0,a.jsx)("ambientLight",{intensity:.7,color:"#3333ff"}),(0,a.jsx)("directionalLight",{position:[3,5,2],intensity:2,color:"#ffffff",castShadow:!0}),(0,a.jsx)("spotLight",{position:[-2,4,4],intensity:2,color:"#00ffff"}),(0,a.jsx)(y,{}),(0,a.jsx)(v,{active:c}),(0,a.jsxs)(s.Suspense,{fallback:(0,a.jsx)(g,{}),children:[(0,a.jsx)("group",{ref:d,children:(0,a.jsx)(h,{vrmId:t,emotion:r,unlocked:n,isApproaching:c,onReady:e=>{m(e=>e+1),i&&i()}})}),(0,a.jsx)(j,{targetRef:d,triggerKey:t+u}),(0,a.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-1.2,0],receiveShadow:!0,children:[(0,a.jsx)("planeGeometry",{args:[10,10]}),(0,a.jsx)("shadowMaterial",{opacity:.7,color:"#000000"})]})]})]})},t)})}let N=[{id:"avatar_01",label:"C1\xb7原型"},{id:"avatar_02",label:"C2\xb7機動"},{id:"avatar_03",label:"C3\xb7重裝"},{id:"avatar_04",label:"C4\xb7特務"}],M=[{id:"blue",label:"天空藍",color:"#3b82f6"},{id:"purple",label:"霓虹紫",color:"#a855f7"},{id:"orange",label:"太陽橘",color:"#f97316"},{id:"cyan",label:"駭客青",color:"#22d3ee"}],S=[{id:"warm",label:"熱情"},{id:"cool",label:"冷靜"},{id:"dark",label:"腹黑"},{id:"shy",label:"害羞"}];function E(e){let{title:t,options:r,selectedId:o,onSelect:n}=e,l=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(l.current){let e=r.findIndex(e=>e.id===o);-1!==e&&(l.current.scrollTop=48*e)}},[]),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 min-w-[100px] flex-1 snap-center",children:[(0,a.jsx)("div",{className:"text-[10px] font-bold text-cyan-500 tracking-widest uppercase mb-1",children:t}),(0,a.jsxs)("div",{className:"relative h-36 w-full max-w-[120px] bg-gray-900/50 rounded-xl border border-gray-700/50 backdrop-blur-md overflow-hidden shadow-inner group",children:[(0,a.jsx)("div",{className:"absolute top-1/2 left-0 w-full h-12 -translate-y-1/2 border-y-2 border-cyan-400 bg-cyan-400/10 pointer-events-none z-10 shadow-[0_0_15px_rgba(34,211,238,0.2)]"}),(0,a.jsx)("div",{ref:l,onScroll:e=>{let t=Math.round(e.target.scrollTop/48);if(t>=0&&t<r.length){let e=r[t].id;e!==o&&n(e)}},className:"w-full h-full overflow-y-auto snap-y snap-mandatory no-scrollbar py-12",children:r.map(e=>{let t=o===e.id;return(0,a.jsxs)("div",{onClick:()=>{n(e.id);let t=r.findIndex(t=>t.id===e.id);l.current&&l.current.scrollTo({top:48*t,behavior:"smooth"})},className:"\n                  h-12 w-full flex items-center justify-center snap-center transition-all duration-300 cursor-pointer\n                  ".concat(t?"text-white scale-110 font-bold":"text-gray-600 scale-90 opacity-50","\n                "),children:[e.color&&(0,a.jsx)("span",{className:"w-2 h-2 rounded-full mr-2 shadow-[0_0_5px_currentColor]",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"text-sm",children:e.label})]},e.id)})}),(0,a.jsx)("div",{className:"absolute inset-x-0 top-0 h-8 bg-gradient-to-b from-black/80 to-transparent pointer-events-none z-20"}),(0,a.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-8 bg-gradient-to-t from-black/80 to-transparent pointer-events-none z-20"})]})]})}function k(e){let{onChange:t}=e,[r,o]=(0,s.useState)({model:"avatar_01",color:"blue",personality:"warm"});(0,s.useEffect)(()=>{t&&t(r)},[r,t]);let n=(e,t)=>{o(r=>({...r,[e]:t}))};return(0,a.jsx)("div",{className:"w-full pb-safe-bottom px-4",children:(0,a.jsxs)("div",{className:"flex flex-row gap-2 overflow-x-auto snap-x snap-mandatory no-scrollbar pb-4 items-start justify-start md:justify-center",children:[(0,a.jsx)(E,{title:"MODEL",options:N,selectedId:r.model,onSelect:e=>n("model",e)}),(0,a.jsx)(E,{title:"COLOR",options:M,selectedId:r.color,onSelect:e=>n("color",e)}),(0,a.jsx)(E,{title:"TYPE",options:S,selectedId:r.personality,onSelect:e=>n("personality",e)})]})})}function _(){let[e,t]=(0,s.useState)([{id:1,role:"ai",text:"系統連線成功。我是妳的專屬 AI 夥伴 Aria，請多指教！✨"}]),[r,o]=(0,s.useState)(""),[n,l]=(0,s.useState)(!1),i=(0,s.useRef)(null);(0,s.useEffect)(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[e,n]);let c=async e=>{if(e.preventDefault(),r.trim()&&!n){o(""),t(e=>[...e,{id:Date.now(),role:"user",text:r}]),l(!0);try{let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r})}),a=await e.json();t(e=>[...e,{id:Date.now()+1,role:"ai",text:a.reply}])}catch(e){t(e=>[...e,{id:Date.now()+1,role:"ai",text:"⚠️ 連線錯誤，請檢查網路狀態。"}])}finally{l(!1)}}};return(0,a.jsxs)("div",{className:"absolute inset-x-0 bottom-8 z-50 flex flex-col items-center pointer-events-none",children:[(0,a.jsxs)("div",{className:"w-full max-w-lg px-4 mb-4 flex flex-col gap-2 max-h-[40vh] overflow-y-auto pointer-events-auto no-scrollbar",ref:i,children:[e.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"\n              max-w-[80%] px-4 py-2 rounded-2xl text-sm backdrop-blur-md shadow-lg border border-white/10\n              ".concat("user"===e.role?"bg-blue-600/80 text-white rounded-br-none":"bg-gray-900/80 text-cyan-100 rounded-bl-none animate-fadeIn","\n            "),children:["ai"===e.role&&(0,a.jsx)("span",{className:"text-[10px] text-cyan-400 block mb-1 font-bold tracking-wider",children:"AI"}),e.text]})},e.id)),n&&(0,a.jsx)("div",{className:"flex justify-start animate-pulse",children:(0,a.jsx)("div",{className:"bg-gray-900/60 text-cyan-400 px-4 py-2 rounded-2xl rounded-bl-none text-xs border border-cyan-500/30 backdrop-blur-md",children:"Aria 正在思考中... \uD83D\uDCAD"})})]}),(0,a.jsxs)("form",{onSubmit:c,className:"w-full max-w-md px-4 pointer-events-auto",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full opacity-30 group-hover:opacity-70 transition duration-300 blur"}),(0,a.jsxs)("div",{className:"relative flex items-center bg-black/80 backdrop-blur-xl rounded-full border border-white/10 p-1 shadow-2xl",children:[(0,a.jsx)("input",{type:"text",value:r,onChange:e=>o(e.target.value),placeholder:"輸入訊息...",className:"flex-1 bg-transparent text-white px-4 py-3 focus:outline-none placeholder-gray-500 text-sm"}),(0,a.jsx)("button",{type:"submit",disabled:n,className:"p-3 rounded-full transition-all duration-300 ".concat(n?"bg-gray-600 cursor-not-allowed":"bg-gradient-to-r from-cyan-600 to-blue-600 hover:scale-105 active:scale-95"),children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4 text-white",children:(0,a.jsx)("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})})})]})]}),(0,a.jsx)("p",{className:"text-center text-[10px] text-gray-500 mt-2 font-mono",children:"POWERED BY OPENAI NEURAL NET"})]})]})}let A="my_ai_character";function L(e){try{localStorage.setItem(A,JSON.stringify(e))}catch(e){}}function I(e){let{onComplete:t}=e,[r,o]=(0,s.useState)(0);return(0,s.useEffect)(()=>{let e=setInterval(()=>{o(r=>r>=100?(clearInterval(e),setTimeout(t,500),100):r+15*Math.random())},150);return()=>clearInterval(e)},[t]),(0,a.jsx)("div",{className:"flex flex-col items-center justify-center h-full bg-black font-mono z-50",children:(0,a.jsxs)("div",{className:"w-64",children:[(0,a.jsx)("h1",{className:"text-blue-400 text-xs tracking-[0.3em] mb-2 animate-pulse",children:"SYSTEM INITIALIZING..."}),(0,a.jsx)("div",{className:"w-full h-1 bg-gray-800 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-blue-500 shadow-[0_0_10px_#3b82f6] transition-all duration-200 ease-out",style:{width:"".concat(r,"%")}})}),(0,a.jsx)("div",{className:"text-[10px] text-gray-500 mt-2 h-4 overflow-hidden",children:r<100?"LOADING MODULE: 0x".concat(Math.floor(1234*r).toString(16)):"COMPLETE"})]})})}function D(){return(0,a.jsxs)("div",{className:"absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/90 backdrop-blur-xl animate-fadeIn",children:[(0,a.jsxs)("div",{className:"relative w-24 h-24 mb-6",children:[(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-blue-500/20 rounded-full"}),(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-t-blue-500 rounded-full animate-spin"}),(0,a.jsx)("div",{className:"absolute inset-4 border-4 border-t-cyan-400 rounded-full animate-spin-reverse opacity-70"})]}),(0,a.jsx)("h2",{className:"text-xl font-bold text-white tracking-widest animate-pulse",children:"AI 系統啟動提取中..."}),(0,a.jsx)("p",{className:"text-blue-400 text-xs mt-2 font-mono",children:"DOWNLOADING NEURAL MODEL..."})]})}function C(){let[e,t]=(0,s.useState)("boot"),[r,o]=(0,s.useState)(""),[n,l]=(0,s.useState)(null),[i,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!1),[m,x]=(0,s.useState)(!1),[p,f]=(0,s.useState)(!1),[h,b]=(0,s.useState)(!1),[g,y]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{u(!0);try{let e=function(){try{return JSON.parse(localStorage.getItem(A))}catch(e){return null}}();e&&e.email&&("C1"===e.model&&(e.model="avatar_01",L(e)),"C2"===e.model&&(e.model="avatar_02",L(e)),c(e),t("chat"),f(!0))}catch(e){}},[]),!d)return(0,a.jsx)("div",{className:"bg-black h-screen"});let v="create"===e?(null==n?void 0:n.model)||"avatar_01":(null==i?void 0:i.model)||"avatar_01";"C1"===v&&(v="avatar_01"),"C2"===v&&(v="avatar_02");let j=("create"===e?null==n?void 0:n.personality:null==i?void 0:i.personality)==="cool"?"neutral":"happy";return(0,a.jsxs)("main",{className:"relative w-full h-screen overflow-hidden bg-black text-white font-sans",children:["boot"===e&&(0,a.jsx)(I,{onComplete:()=>{t("email")}}),"email"===e&&(0,a.jsx)("div",{className:"absolute inset-0 z-30 flex flex-col items-center justify-center px-6",children:(0,a.jsxs)("div",{className:"w-full max-w-md bg-gray-900/80 p-8 rounded-3xl border border-blue-500/30 backdrop-blur-md shadow-[0_0_50px_rgba(59,130,246,0.2)] transition-all duration-700 ease-in-out ".concat(m?"scale-0 opacity-0 translate-y-20 filter blur-xl":"scale-100 opacity-100 animate-fadeIn"),children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-center mb-2 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-cyan-300 tracking-wider",children:"SYSTEM LOGIN"}),(0,a.jsx)("p",{className:"text-gray-400 text-xs text-center mb-8 font-mono",children:"請綁定您的 ID (Email) 以連結神經網路"}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!r.trim())return alert("請輸入信箱以連結神經網路！");x(!0),setTimeout(()=>{t("extracting")},800)},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-xl opacity-30 group-hover:opacity-100 transition duration-500 blur"}),(0,a.jsx)("input",{type:"email",value:r,onChange:e=>o(e.target.value),placeholder:"name@example.com",className:"relative w-full bg-black border border-gray-700 rounded-xl py-4 px-4 text-white placeholder-gray-600 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all",required:!0})]}),(0,a.jsxs)("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-[0_0_20px_rgba(37,99,235,0.5)] active:scale-95 flex justify-center items-center gap-2",children:[(0,a.jsx)("span",{children:"確認連結"}),(0,a.jsx)("span",{className:"text-xs",children:"CONNECT"})]})]})]})}),"extracting"===e&&(0,a.jsx)(D,{}),("extracting"===e||"create"===e||"chat"===e)&&(0,a.jsx)("div",{className:"absolute inset-0 z-0 transition-opacity duration-1000 ".concat("extracting"!==e||h?"opacity-100":"opacity-0"),children:(0,a.jsx)(s.Suspense,{fallback:null,children:(0,a.jsx)(w,{vrmId:v,emotion:j,unlocked:p,isApproaching:g,onModelReady:()=>{"extracting"===e&&setTimeout(()=>{t("create")},1500),b(!0)}})})}),"create"===e&&(0,a.jsxs)("div",{className:"absolute inset-0 z-10 flex flex-col justify-end pointer-events-none transition-all duration-700 ".concat(g?"opacity-0 translate-y-20":"opacity-100"),children:[(0,a.jsx)("div",{className:"absolute top-24 w-full text-center pointer-events-none",children:(0,a.jsx)("span",{className:"bg-blue-500/10 text-blue-300 text-[10px] px-3 py-1 rounded-full border border-blue-500/20 backdrop-blur animate-pulse",children:"⚠️ 實體化數據不足，僅顯示全像投影"})}),(0,a.jsxs)("div",{className:"w-full px-6 mb-2 flex justify-between items-end pointer-events-auto z-20 relative top-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:"角色設定"}),(0,a.jsx)("p",{className:"text-[10px] text-cyan-400 tracking-widest font-bold drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"SYSTEM CONSOLE"})]}),(0,a.jsxs)("button",{onClick:()=>{try{let e={email:r,name:"My AI Buddy",...n||{model:"avatar_01",personality:"warm"},createdAt:new Date().toISOString()};L(e),c(e),y(!0),f(!0),setTimeout(()=>{t("chat"),y(!1)},2e3)}catch(e){alert("Error: "+e.message)}},className:"group bg-blue-600 hover:bg-blue-500 text-white px-5 py-3 rounded-full font-bold shadow-[0_0_15px_rgba(37,99,235,0.5)] active:scale-95 flex items-center gap-2 cursor-pointer border border-blue-400/30",children:[(0,a.jsx)("span",{className:"text-sm",children:"完成"}),(0,a.jsx)("span",{className:"group-hover:translate-x-1 transition-transform",children:"➜"})]})]}),(0,a.jsxs)("div",{className:"w-full pointer-events-auto relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-[#02020a] via-[#0a0a1a]/90 to-transparent border-t border-cyan-500/30 shadow-[0_-10px_30px_rgba(0,255,255,0.1)] backdrop-blur-xl clip-path-console-top"}),(0,a.jsx)("div",{className:"absolute top-0 inset-x-0 h-[1px] bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent"}),(0,a.jsx)("div",{className:"relative z-10 pt-6 pb-safe-bottom",children:(0,a.jsx)(k,{onChange:e=>{l(e)}})})]})]}),"chat"===e&&i&&(0,a.jsxs)("div",{className:"relative z-10 w-full h-full animate-fadeIn pointer-events-none",children:[(0,a.jsx)(_,{}),(0,a.jsx)("div",{className:"absolute top-4 left-4 z-50 flex flex-col gap-2 pointer-events-auto",children:(0,a.jsx)("button",{onClick:()=>{confirm("確定要重置系統嗎？所有記憶將被清除。")&&(localStorage.removeItem(A),c(null),o(""),t("boot"),x(!1),f(!1),b(!1),y(!1))},className:"bg-red-900/50 text-white/50 text-[10px] px-2 py-1 rounded hover:text-white backdrop-blur-sm cursor-pointer",children:"RESET SYSTEM"})})]})]})}}},function(e){e.O(0,[689,599,79,971,23,744],function(){return e(e.s=4830)}),_N_E=e.O()}]);